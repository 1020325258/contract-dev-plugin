---
name: tdd-workflow
description: 测试驱动开发工作流原则。RED-GREEN-REFACTOR 循环。
allowed-tools: Read, Write, Edit, Glob, Grep, Bash
---

# TDD 工作流

> 先写测试，后写代码。

## 销售项目测试代码相关规范
1. 测试代码所属路径：utopia-nrs-sales-project-start/src/test/java/com/ke/utopia/nrs/salesproject
2. 命名：保证清晰易读的命名和分组
---

## 1. TDD 循环

```
🔴 RED → 编写失败的测试
    ↓
🟢 GREEN → 编写最少代码使测试通过
    ↓
🔵 REFACTOR → 改进代码质量
    ↓
   重复...
```

---

## 2. TDD 三定律

1. 只为使失败的测试通过而编写生产代码
2. 只编写刚好能证明失败的测试
3. 只编写刚好能使测试通过的代码

---

## 3. RED 阶段原则

### 编写内容

| 关注点 | 示例 |
|-------|---------|
| 行为 | "应当将两个数字相加" |
| 边界情况 | "应当处理空输入" |
| 错误状态 | "应当对无效数据抛出异常" |

### RED 阶段规则

- 测试必须首先失败
- 测试名称描述预期行为
- 每个测试一个断言（理想情况）

---

## 4. GREEN 阶段原则

### 最少代码

| 原则 | 含义 |
|-----------|---------|
| **YAGNI** | 你不会需要它（You Aren't Gonna Need It） |
| **最简单的事情** | 编写最少代码使测试通过 |
| **不优化** | 只要能工作就行 |

### GREEN 阶段规则

- 不编写不需要的代码
- 暂不优化
- 通过测试，仅此而已

---

## 5. REFACTOR 阶段原则

### 改进内容

| 领域 | 操作 |
|------|--------|
| 重复 | 提取公共代码 |
| 命名 | 明确意图 |
| 结构 | 改进组织 |
| 复杂度 | 简化逻辑 |

### REFACTOR 规则

- 所有测试必须保持绿色
- 小步渐进式修改
- 每次重构后提交

---

## 6. AAA 模式

每个测试遵循：

| 步骤 | 目的 |
|------|---------|
| **Arrange（准备）** | 设置测试数据 |
| **Act（执行）** | 执行被测代码 |
| **Assert（断言）** | 验证预期结果 |

---

## 7. 何时使用 TDD

| 场景 | TDD 价值 |
|----------|-----------|
| 新功能 | 高 |
| Bug 修复 | 高（先写测试） |
| 复杂逻辑 | 高 |
| 探索性开发 | 低（先探索，再 TDD） |
| UI 布局 | 低 |

---

## 8. 测试优先级

| 优先级 | 测试类型 |
|----------|-----------|
| 1 | 正常路径 |
| 2 | 错误情况 |
| 3 | 边界情况 |
| 4 | 性能 |

---

## 9. 反模式

| ❌ 不要做 | ✅ 应该做 |
|----------|-------|
| 跳过 RED 阶段 | 先看到测试失败 |
| 先写代码后写测试 | 先写测试后写代码 |
| 过度设计初始实现 | 保持简单 |
| 多个断言 | 每个测试一个行为 |
| 测试实现细节 | 测试行为 |

---

## 10. AI 增强 TDD

### 多智能体模式

| 智能体 | 职责 |
|-------|------|
| Agent A | 编写失败的测试（RED） |
| Agent B | 实现使其通过（GREEN） |
| Agent C | 优化（REFACTOR） |

---

> **记住：** 测试即规范。如果你无法编写测试，说明你不理解需求。